# MySQL NDB In-Memory Database Cluster

This Nutanix Calm blueprint will deploy MySQL NDB, a highly-available, in-memory MySQL implementation.

The intention of this blueprint, aside from MySQL NDB itself, is to demonstrate the use of Calm-generated workflows between service actions.  Looking at the blueprint, you'll see that there are no manually-created dependencies between services.  Dependencies have been automatically generated by the use of 'Calm Macros', variables that return information about an application component.

## Components

- 1x CentOS 7 MySQL NDB Manager
- 1x CentOS 7 ProxySQL server, used to distribute client connections across the MySQL cluster/pool 
- 2x CentOS 7 MySQL NDB 'Data Nodes' (edit blueprint to enable more)
- 2x CentOS 7 MySQL 'SQL Nodes' (edit blueprint to enable more)

## Prerequisites

To deploy this blueprint you will need the following things available.

- A CentOS 7 Linux VM image, published via the Nutanix Image Service
- Username and password for your Linux image (note that this blueprint does not natively use public/private key authentication)

## Usage

- Import the blueprint into your Nutanix Calm environment
- Adjust credentials to suit your requirements (the import will warn about blueprint validation errors, since credentials are not saved in exported blueprints)
- Alter each Calm service/VM so that it deploys your CentOS 7 image
- Alter each Calm service/VM so that it connects to your preferred network
- Launch the blueprint
- Fill in all required runtime variables, paying particular attention to the credentials section

## After Deployment

The MySQL servers deployed by this application belong to a server pool.  This pool is created and managed by the ProxySQL server.

While it is possible to login directly to the MySQL 'SQL Nodes' and issue SQL commands, the ProxySQL server enables a central login point that will distribute connections across the members of the pool.

For example, the following command within an SSH session will login to the ProxySQL MySQL client.  The password, when prompted, is the value of APP_DB_PASSWORD variable specified at blueprint launch. 

```
/usr/bin/mysql -u <your_app_db_user> -p -h 127.0.0.1 -P 6033
```

Port 6033 is the port on which ProxySQL listens for client connections.
 
From within the MySQL client, it is then possible to run standard MySQL 5.6 SQL queries, each of which will be issued on the 'SQL Node' pool members.

## Viewing MySQL NDB Configuration

SSH to the MySQL NDB Manager and issue the following command.

```
ndb_mgm -e "SHOW"
```

This will return the MySQL NDB configuration, showing the manager, the data nodes and the SQL nodes that have been deployed.

## Screenshots

![Blueprint Design - No Dependencies](https://raw.githubusercontent.com/digitalformula/nutanix-blueprints/master/mysql-ndb-cluster/images/mysql-ndb-blueprint-no-dependency.png)

![MySQL NDB Blueprint - Running Application](https://raw.githubusercontent.com/digitalformula/nutanix-blueprints/master/mysql-ndb-cluster/images/mysql-ndb-app-running.png)

![MySQL NDB - Sample Manager Configuration with 10 Data & SQL Nodes](https://raw.githubusercontent.com/digitalformula/nutanix-blueprints/master/mysql-ndb-cluster/images/mysql-ndb-manager-view.png)

![ProxySQL showing the assigned node for this MySQL client session](https://raw.githubusercontent.com/digitalformula/nutanix-blueprints/master/mysql-ndb-cluster/images/mysql-ndb-selected-hostname.png)

![SQL Nodes offline (shunned) at deployment, online when required](https://raw.githubusercontent.com/digitalformula/nutanix-blueprints/master/mysql-ndb-cluster/images/mysql-ndb-sql-servers-online.png)

![MySQL NDB identifying node as offline](https://raw.githubusercontent.com/digitalformula/nutanix-blueprints/master/mysql-ndb-cluster/images/mysql-ndb-server-offline.png)

## Support

These blueprints are *unofficial* and are not supported or maintained by Nutanix in any way.

In addition, please also be advised that these blueprints may deploy applications that do not follow best practices.  Please check through each blueprint to ensure the configuration suits your requirements.

***Changes will be required before these application blueprints can be used in production environments.***